# Test Configuration with Testcontainers (MySQL)
# Datasource will be configured dynamically by Testcontainers via @DynamicPropertySource

# MySQL connection properties - disable SSL for Testcontainers Cloud
spring.datasource.hikari.data-source-properties.sslMode=DISABLED
spring.datasource.hikari.data-source-properties.allowPublicKeyRetrieval=true
spring.datasource.hikari.data-source-properties.useSSL=false
# MySQL auto-reconnect settings
spring.datasource.hikari.data-source-properties.autoReconnect=true
spring.datasource.hikari.data-source-properties.failOverReadOnly=false
spring.datasource.hikari.data-source-properties.maxReconnects=10
# TCP keepalive for Testcontainers Cloud
spring.datasource.hikari.data-source-properties.tcpKeepAlive=true

# HikariCP Connection Pool Settings for Testcontainers Cloud
# Using smaller pool with aggressive connection validation for cloud reliability
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=60000
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.max-lifetime=60000
spring.datasource.hikari.keepalive-time=15000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.leak-detection-threshold=30000
# Auto-commit and pool behavior for test stability
spring.datasource.hikari.auto-commit=true
spring.datasource.hikari.pool-name=TestHikariPool
# Initialize fail timeout - allow more time for cloud connection
spring.datasource.hikari.initialization-fail-timeout=60000
# Register MBeans for debugging connection pool issues
spring.datasource.hikari.register-mbeans=true

# JPA Configuration
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.open-in-view=false

# Flyway - enabled for tests to run migrations on container DB
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration

# JWT Configuration for tests
jwt.secret=VGhpc0lzQVZlcnlTZWN1cmVTZWNyZXRLZXlGb3JUZXN0aW5nUHVycG9zZXNPbmx5MTIzNDU2Nzg5MA==
jwt.expiration=3600
jwt.refresh-expiration=86400

# Disable caching for tests
spring.cache.type=none

# Cloudinary mock config
cloudinary.cloud-name=test
cloudinary.api-key=test
cloudinary.api-secret=test

# Stripe mock config for tests
stripe.api-key=sk_test_mock_key_for_testing
stripe.webhook-secret=whsec_test_mock_secret

# Disable mail for tests
spring.mail.host=localhost
spring.mail.port=25

# Logging for tests
logging.level.org.testcontainers=INFO
logging.level.com.github.dockerjava=WARN
logging.level.org.springframework.test=INFO

# OAuth2 mock config (disabled for tests)
spring.security.oauth2.client.registration.google.client-id=test-client-id
spring.security.oauth2.client.registration.google.client-secret=test-client-secret
